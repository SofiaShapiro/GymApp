var mainWin = Titanium.UI.createWindow({
    backgroundColor:'#FFFFFF',
    layout:'vertical'
});
 
var exercisesWin = Titanium.UI.createWindow({
    backgroundColor:'#FFFFFF',
    layout:'vertical'
});
var exercisesview = Titanium.UI.createScrollView({
    scrollType:"vertical",
    left:'0dp',
    width:'100%'
});

var formsWin = Titanium.UI.createWindow({
    backgroundColor:'#FFFFFF',
    layout:'vertical'
});
var formsview = Titanium.UI.createScrollView({
    scrollType:"vertical",
    left:'0dp',
    width:'100%'
});

var groupview = Titanium.UI.createScrollView({
    scrollType:"vertical",
    left:'0dp',
    width:'100%'
});
 
var btnHeight = 50;
var db = Ti.Database.install('/database.db', 'dymdatabase');
var groups = db.execute('SELECT * FROM groups');
var i = 0;
while (groups.isValidRow())
{
	groupview.add(Titanium.UI.createButton({
    width:'100%',
    top: i * btnHeight,
    height: btnHeight,
    numId: groups.fieldByName('id'),
    title: groups.fieldByName('name'),
	}));
	groups.next();
	i++;
}
var exercise_buttons = [];
groups.close();
groupview.addEventListener('click', function (e) {
	var exercises = db.execute("SELECT * FROM list where muscle_group = ?", e.source.title);
	var k = 0;
	for (i = 0; i < exercise_buttons.length; i++)
	{
		exercisesview.remove(exercise_buttons[i]);
	}
	while (exercises.isValidRow())
	{
		var button = Titanium.UI.createButton({
	    width:'100%',
	    top: k * btnHeight,
	    height:btnHeight,
	    numId:exercises.fieldByName('id'),
	    title: exercises.fieldByName('name'),
		});
		exercise_buttons.push(button);
		exercisesview.add(button);
		exercises.next();
		k++;
	}
	var forms = [];
	exercisesview.addEventListener('click', function(e) {
		var chosen = db.execute("SELECT * FROM list where name = ?", e.source.title);
		var p = 0;
		for (i = 0; i < forms.length; i++)
		{
			formsview.remove(forms[i]);
		}
		var options = ['time', 'sets', 'reps', 'weight'];
		for (z = 0; z < options.length; z++)
		{
			if (chosen.fieldByName(options[z]) == 1)
			{
				var field = Ti.UI.createTextField({
					color: '#333333',
					hintText: options[z],
					height: 35,
					top: 10 + (35 * p),
					left: 10,
					width: 90,
				});
				forms.push(field);
				formsview.add(field);
				p++;
				alert(p);
			}
		}
		chosen.close();
		formsWin.add(formsview);
		formsWin.open();
	});
	exercises.close();
	exercisesWin.add(exercisesview);
	exercisesWin.open();
});

mainWin.add(groupview);
mainWin.open();

